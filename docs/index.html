<!DOCTYPE html><html lang="en"><head><title>OAuth.ee</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700&amp;subset=latin-ext,cyrillic-ext" rel="stylesheet" type="text/css"><link href="https://cdn.jsdelivr.net/gh/twbs/bootstrap@3/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v0/dist/bootstrap-toc.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9/build/styles/monokai-sublime.min.css" rel="stylesheet" type="text/css"><script defer data-domain="entu.dev" src="https://plausible.io/js/plausible.js"></script><style>body{padding-top:30px;padding-bottom:30px;font-family:'Helvetica Neue',Roboto,sans-serif;font-size:16px;font-weight:300;line-height:22px;color:#182530}h1{margin-top:120px;margin-bottom:110px;font-size:48px;font-weight:100;text-align:center}h2{margin-top:200px;margin-bottom:30px;padding-top:40px;font-size:32px;font-weight:100;text-align:center}h3{margin-top:120px;margin-bottom:10px;padding-top:40px;padding-bottom:5px;color:#23241f;font-weight:500;border-bottom:1px solid #e8e8e8}h4{margin-top:0;margin-bottom:10px;padding-top:40px;color:#23241f;font-weight:500}pre{margin-top:10px;padding:0;border:none;border-radius:0;font-size:12px;line-height:16px}pre code{border-radius:5px}.hljs{padding:1em}</style></head><body data-spy="scroll" data-target="#toc"><div class="container-fluid"><div class="row"><div class="hidden-xs col-sm-2"><nav id="toc" data-spy="affix" data-toggle="toc"></nav></div><div class="col-xs-12 col-sm-8"><h1>OAuth.ee</h1><p>Use Estonian ID-card, Mobile-ID and Smart-ID as OAuth authentication provider</p><h2>Usage</h2><ol><li><p>Redirect user to one of the following url:</p><ul><li>/auth/id-card</li><li>/auth/mobile-id</li><li>/auth/smart-id</li><li>/auth/e-mail</li></ul><p>Required query parameters are:</p><ul><li>response_type (always equals to &quot;code&quot;)</li><li>client_id</li><li>redirect_uri</li><li>scope</li><li>state</li></ul><p>After authentication user is redirected back to url set in <em>redirect_uri</em> parameter. Query parameter <em>code</em> contains the authorization code which Your service will exchange for an access token.</p><p>If the initial request contained a <em>state</em> parameter, the response also includes the exact value from the request. Your service must check if it matches one from initial request.</p></li><li><p>Make POST request to <strong>/token</strong> sending <em>grant_type</em> and <em>code</em>. Parameter grant_type must always be &quot;authorization_code&quot; and <em>code</em> is from previous step.</p><p>Response contains <em>access_token</em> what You need to get user information.</p></li><li><p>To get user information make GET request to <strong>/user</strong> with <em>access_token</em> parameter or as Bearer authorization header.</p><p>Response contains user information as JSON object.</p></li></ol><h2>Setup</h2><ol><li>Clone this repository and go to it's folder:<pre><code class="language-shell">git clone https://github.com/argoroots/est-o-auth.git ./est-o-auth
cd est-o-auth
</code></pre></li><li>Rename <em>env.example</em> to <em>.env</em>:<pre><code class="language-shell">cp .env.example .env
</code></pre></li><li>In <em>.env</em> file, set correct domains for authentication and id-card services (Nginx needs separate domain for ID-Card authentication); e-mail address (to get Let's Encrypt cert expiration notifications) and some random string for JWT token signing.<pre><code>DOMAIN=auth.example.com
IDCARD_DOMAIN=id.auth.example.com
EMAIL=auth@example.com
JWT_SECRET=Iel0jrC7fKFMjK2OBI4VYp2ygtrDQZBV
</code></pre></li><li>Generate certs for HTTPS:<pre><code class="language-shell">docker-compose --project-directory ./ -f ./docker-compose/certbot.yaml up --abort-on-container-exit
</code></pre></li><li>Get ID-Card certs:<pre><code class="language-shell">docker-compose --project-directory ./ -f ./docker-compose/id-card.yaml up
</code></pre></li></ol><h2>Run service</h2><p>To start oauth service run:</p><pre><code class="language-shell">docker-compose --project-directory ./api -f ./docker-compose/auth.yaml up -d --build --remove-orphans
</code></pre><h2>Renew certificates</h2><p>To renew certificates run:</p><pre><code class="language-shell">docker-compose --project-directory ./ -f ./docker-compose/certbot.yaml -f ./docker-compose/certbot-renew.yaml up --abort-on-container-exit
docker-compose restart nginx
</code></pre></div></div></div><script src="https://cdn.jsdelivr.net/gh/jquery/jquery@2/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/twbs/bootstrap@3/dist/js/bootstrap.min.js"></script><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v0/dist/bootstrap-toc.min.js"></script><script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9/build/highlight.min.js"></script><script>hljs.initHighlightingOnLoad()</script></body></html>